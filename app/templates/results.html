<html>
    <head>
        <link rel="stylesheet" href="static/bootstrap.min.css">
        <link rel="stylesheet" href="/static/main.css"/>
        <link rel="stylesheet" href="/static/all.css"/>
        <link href="/static/sliptree-bootstrap-tokenfield-9c06df4/dist/css/bootstrap-tokenfield.min.css" rel="stylesheet" type="text/css">
        <script src="static/jquery-3.3.1.min.js" type = "text/javascript"></script>
        <script type="text/javascript" src="/static/sliptree-bootstrap-tokenfield-9c06df4/dist/bootstrap-tokenfield.min.js"></script>
        <script type="text/javascript" src="/static/bootstrap3-typeahead.min.js"></script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


        <script type="text/javascript">
            /*Scroll to top when arrow up clicked BEGIN*/
            $(window).scroll(function() {
                var height = $(window).scrollTop();
                if (height > 100) {
                    $('#back2Top').fadeIn();
                } else {
                     $('#back2Top').fadeOut();
                 }
            });
            /*Scroll to top when arrow up clicked END*/
            // document ready 

            $(document).ready(function() {
            // scorring effect take place and slowing down the speed of the scroll
             $("#back2Top").click(function(event) {
                event.preventDefault();
                $("html, body").animate({ scrollTop: 0 }, "slow");
                return false;
                });
                // when image gets clicked
                $(".img-click").click(function(event){
                   
                    var x = $(this).attr("href"); //get the atrribute of this image
                  
                    if (document.querySelector(x).classList.contains('hidden')) {
                        $(x).removeClass("hidden"); // show the information correlated with the id in the link
                        $('.dis').addClass("hidden"); // hide the searches and gallary
                    }
                });
                //when you click the go back button
                $(".back2searches").click(function(event){
                        $('.dis').removeClass("hidden"); //show the gallary 
                        $('.main-cointainer').addClass('hidden'); //hide the information about the show you clicked
                    });
                // when you click on the similarity score link
                $(".score").click(function(event){
                    var x = $(this).attr("href")+"scoreh"; //get the id associated with this link
                    var y = $(this).attr("href")+"infoh"; //get the id associated with this link
                    var z = $(this).attr("href")+"cast"; // get the id associated with this link
            
                    if (document.querySelector(x).classList.contains('hidden')) {
                        //hide the information of the other two tabs and show the one of the tab you wank
                        $(x).removeClass('hidden');
                        $(y).addClass('hidden');
                        $(z).addClass('hidden');
                        // display which section you are on
                        $(this).addClass('clicked');
                        $('.info').removeClass('clicked');
                        $('.cast').removeClass('clicked');
                        
                    }
                });
                // information is the same as the previous .click function 
                $(".info").click(function(event){
                    var x = $(this).attr("href")+"scoreh";
                    var y = $(this).attr("href")+"infoh";
                    var z = $(this).attr("href")+"cast";
        
                    if (document.querySelector(y).classList.contains('hidden')) {                  
                        $(y).removeClass('hidden');
                        $(x).addClass('hidden');
                        $(z).addClass('hidden');
                        $(this).addClass('clicked');
                        $('.score').removeClass('clicked');
                        $('.cast').removeClass('clicked');

                    }

                });
                // information is the same as the previous .click function 
                $(".cast").click(function(event){
                    var x = $(this).attr("href")+"scoreh";
                    var y = $(this).attr("href")+"infoh";
                    var z = $(this).attr("href")+"cast";
           
                  
                    if (document.querySelector(z).classList.contains('hidden')) {
                        $(z).removeClass('hidden');
                        $(x).addClass('hidden');
                        $(y).addClass('hidden');
                        $(this).addClass('clicked');
                        $('.info').removeClass('clicked');
                        $('.score').removeClass('clicked');

                    }

                });


            });
            
        </script>
    </head>
    <body id = "resultsform">

            <form class="form-inline global-search content">
                <!-- Go back to search engine page -->
            <div> <button id ='new-search' type="submit" class="btn btn-info" name = 'new-search'> Make a new Search </button></div>
                
                 <div class = "gallary_class">
                   {% if not output.empty %}
                   <script>
                    //    storing all titles here
                    var ids = [];
                   </script>
                        <!-- run the loop of all results found -->
                         {% for y in output %}
                         <script>
                        // using the titles to make unike ids for hyperlinks
                         var this_id = "{{ y[: y.find(',')]}}";
                         ids.push(this_id);
                        //  var q = document.getElementsByClassName('gallarydisplay'); //get all containers with this tag
                        //  for (i = 0; i < q.length; i++) {
                        //         var dis_img = q[i];
                        //         if 
                        //     }

                         
                    </script>
                     <br>
                    <!-- container that holds the gallary in place -->
                    <div class = "dis">
                        <!-- container that has the overlay -->
                        <div class = "gallaryimg">
                           <img class = 'gallarydisplay' src="/static/Show_Images/{{ y[: y.index(',')] }}.jpg" onerror="this.src='/static/Show_Images/A Gentleman’s Dignity.jpg'" alt= "{{ y[: y.find(',')]}}"/>
                           
                           <a class = "img-click" name = "img-click">
                            <div class= 'titleh'>
                                <!-- Displaying the title and similarity score overlay -->
                                <h2>{{  y[: y.index(',')] }}</h2>
                                <div class = 'Similarity'><p>{{  y[y.index("Similarity Score:"):y.index(", Sentiment Score:")] }}%</p></div>

                             </div>
                            </a>
                        </div>
                    </div>
                    <!-- container that contain the information (lol spelt container wrong in the code) -->
                     <div class = "main-cointainer hidden">
                            <!-- main information container -->
                            <div class = "info-container">
                                <!-- div that contain the image -->
                                <div class = 'left-side'>
                                   
                                        <img class = 'gallarydisplay' src="/static/Show_Images/{{ y[: y.index(',')] }}.jpg" onerror="this.src='/static/Show_Images/A Gentleman’s Dignity.jpg'" alt= "{{ y[: y.find(',')]}}"/>
                                </div>

                                <!-- div that contained the information about the show -->
                                <div class = "right-side">
                                    <h2>{{  y[: y.index(',')] }}</h2>
                                <div class = "mini-nav">
                                <nav>
                                    <!-- nav bar of the infomation -->
                                        <ul>
                                            <li><a class = "info clicked" >Overview</a></li>
                                            <li><a class = "cast" >Actors</a></li>
                                            <li><a class = "score " >Similarity Score</a></li>

                                        </ul>
                                    </nav>
                                </div>
                                <!-- this contains the ratings, genre, summary e.t.c -->
                                <div class = "display_info">
                                    
                                                <!-- main overview -->
                                        <div class = 'infoid'>
                                           
                                            <div class = 'rating'><p><strong> Rating: </strong>{{  y[y.find('Rating:')+7 :  y.index(', Runtime')] }}</p><p class = 'right'><strong> Year: </strong>{{  y[y.index('Years:')+6 :y.index(',  Sentiment:')] }}</p></div>
                                            <div class = 'genre'><p><strong> Genres: </strong>{{  y[y.find('Genre:')+6 : y.index(', Rating')] }}</p><p class = "right"><strong> Runtime: </strong>{{  y[y.find('Runtime:')+ 8 :y.index(', Actors')] }}</p></div>
                                            <div class = 'votes'><p><strong> Votes: </strong>{{  y[y.find('Votes')+6 :y.index(', Years')] }}</p></div>

                                            <div class = 'Summary'><p><strong> Summary: </strong>{{y[y.find('Summary:')+8: y.index(',  Genre')] }}</p></div>
                                        </div>
                                            <!-- information about the actors -->
                                        <div class = "castid hidden" >
                                            <div class = 'actors'><strong> Actors: </strong>
                                                {%for x in  y[y.find('Actors:')+ 7 :y.index(', Votes')].split(', ') %}
                                                    <p>{{x}}</p>
                                                {%endfor%}
                                            </div>
                                        </div>
                                            
                                            <!-- informaton about the scores -->
                                        <div class = "scoreid hidden">
                                                <div class =  "users_message">
                                                    <div><strong>User Input:</strong><p>{{output_message}}</p></div>

                                                    <div class = 'Similarity'><strong>This drama's similarity to what you search:</strong><p style= "text-align: center;">{{  y[y.index("Similarity Score:")+17:y.index(", Sentiment Score:")] }}%</p></div>
                            
                                                </div>
                                            
                                           
                                                
                                                <div class = 'translation'>
                                                        <p>
                                                            This graph shows you how simlilar This show is to your search, and why it comes up within your results.
                                                            Hover over the bar to see how similar this show is to your search. 
                                                        </p>
                                                    </div>

                                    
                                                    
                                                
                                            <div class = 'chart'></div>
                                            
                                            <div class= "sentiment">
            
                                                    <strong>Sentiment:</strong> 
                                                    <p>{{  y[y.index("Sentiment Score")+16 :y.index(", Embedding")] }}%
                                                    {{  y[y.index("Sentiment:")+11 :y.index(", Sentiment Reviews")] }}</p>
    
                                                    </div>
                                            <div class = 'reviews'>
                                                <strong>Sentiment Reviews:</strong>
                                                {% for r in y[y.index("Sentiment Reviews:")+19 :y.index(', Total')].replace("'", '"').replace('"]', '').replace('["', '').split('", "') %} 
                                                <p class = "r_style">{{r.replace('"', "'")}}</p>
                                                {%endfor%}
                                             
                                            
                                            
                                            </div> 
                                        </div>
                                       
                                </div>
                            </div>
                            </div>
                            <!-- takes you back to the results you searched  -->
                            <div><a class="back2searches" title="Back to Your Results">  &#10148;</a></div>

                        </div>
                        
                        {% endfor %}
                        <script>
                            
                                // funtion that strips the titles of javascript keywords so we can use the titles as unique ids
                                function make_id(r){
                                    r = r.replace(/[^a-zA-Z0-9]/g, '');
                                    r = r.replace(' ', '');
                                    var rsub = r.substr(0, r.length/2);
                                    if (/\d/.test(rsub)) {
                                        
                                        r = r.substr(r.length/2, r.length);
                                    }
                                    return r
                                }
                                // make the ids
                                var new_ids =[];
                                for (i = 0; i < ids.length; i++) {
                                    new_ids.push( make_id(ids[i]));
                                }
                                var g = document.getElementsByClassName('main-cointainer hidden'); //get all containers with this tag
                                var s = document.getElementsByClassName('img-click'); //get all containers with img-click tag
                                var back_search = document.getElementsByClassName('back2searches'); //get all go back buttons
                                var sim_chart = document.getElementsByClassName('chart'); //get the chart div
                                var get_link = document.getElementsByClassName('img-click'); 
                                var link_to_score = document.getElementsByClassName('scoreid'); // get all elements with this class
                                var link_to_cast = document.getElementsByClassName('castid');
                                var link_to_info = document.getElementsByClassName('infoid');

                                // set the class in this array to be clickable by setting their links
                                var nav_link = ['cast', 'info', 'score'];
                                for (i = 0; i < nav_link.length; i++) {
                                    var link_to = document.getElementsByClassName(nav_link[i]);
                                    for (j = 0; j < link_to.length; j++) {
                                        var to = link_to[j];
                                        to.setAttribute('href', '#'+ new_ids[j]);
                                    }

                                }

                                
                                // Every link in this page should be set here 
                                for (i = 0; i < g.length; i++) {
                                    var this_score = link_to_score[i];
                                    var this_info = link_to_info[i];
                                    var this_cast = link_to_cast[i];
                                    var get_id = g[i];
                                    var set_href = s[i];
                                    var back_search_of_show = back_search[i];
                                    var get_link_href = get_link[i]; 
                                    var chart_link = sim_chart[i];
                                    chart_link.setAttribute('id', new_ids[i]+'similarity');
                                    get_id.setAttribute('id', new_ids[i]);
                                    this_score.setAttribute('id', new_ids[i]+'scoreh');
                                    this_info.setAttribute('id', new_ids[i]+'infoh');
                                    this_cast.setAttribute('id', new_ids[i]+'cast');

                                    get_link_href.setAttribute('href', '#'+ new_ids[i]);
                                    set_href.setAttribute('href', '#'+ new_ids[i]);
                                    back_search_of_show.setAttribute('href', '#'+ new_ids[i]);
                                }
                                // use this to make the chart id unique
                                var count = 0;
                                </script>
                            {% for y in output %}

                            <script type="text/javascript">
                                // Load google charts
                               
                     
                                google.charts.load('current', {'packages':['corechart']});
                                google.charts.setOnLoadCallback(drawChart);
                                
                                // Draw the chart and set the chart values
                               
                                function drawChart() {
                                    // getting the similarity scores
                                    var total_sim = parseFloat( '{{  y[y.index("Similarity Score:")+18 :y.index(", Sentiment Score:")] }}' );
                                    // embedded scores
                                    var  embedding_score =  parseFloat( '{{  y[y.index("Embedding Score")+16 :y.index(", Summary")] }}' );
                                   
                                    // summary scores
                                    var summary_score = parseFloat( '{{  y[y.index("Summary Score:")+15 :y.index(", Actor Score:")] }}' );
                                    // actors similarity
                                    var actors_score = parseFloat( '{{  y[y.index("Actor Score")+12 :y.index(", Genre")] }}' );
                                    // genre similarity
                                    var genre_score = parseFloat( "{{  y[y.index('Genre Score')+12 : ]}}" );
                                   
                                  var data = google.visualization.arrayToDataTable([
                                  ['Inputs', 'Match Percentage'],
                                  ['Total', total_sim],
                                  ['Embedding', embedding_score],
                                  ['Summary', summary_score],
                                  ['Actor', actors_score],
                                  ['Genre', genre_score]
                                ]);
                                
                                  // Optional; add a title and set the width and height of the chart
                                 
                                  var options = {'title':'Similarity Scores',
                                                 'width':500, 
                                                 'height':300,
                                                 legend: { position: "none" },
                                                 hAxis: {title: 'Inputs', titleTextStyle: {color: 'Black'}},
                                                 vAxis: {title: 'Match Percentage',
                                            
                                                        minValue: 0,
                                                        format: '##.#%',
                                                        ticks: [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100]
                                                    }, annotation: {
                                                        textStyle: {
                                                            fontName: 'Times-Roman',
                                                            fontSize: 18,
                                                            bold: true,
                                                            // The color of the text.
                                           
                                                            // The color of the text outline.
                                                          
                                                            // The transparency of the text.
                                                           
                                                            }

                                                    }
                                                    
                                                };

                                
                                  
                                  var chart = new google.visualization.ColumnChart(document.getElementById(new_ids[count]+"similarity"));
                                  chart.draw(data, options);
                                  count++;
                                }
               

                                
                                </script>   
                             {%endfor%} 
                    {% endif %}
                   
                

                </div>

           </form>
           <!-- back to the top arrow -->
           <a id="back2Top" title="Back to top" href="#"> &#10148; </a>


           <!-- footer -->
    <footer>
        <div>
            <p>Project Name: {{ name }}</p>
            <p>Student Name: ({{ netid }})</p>
        </div>
    </footer>

    </body>

</html>
